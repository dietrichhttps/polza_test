# Тестовое задание по Python и архитектуре

## Структура проекта

```
polza_test/
├── email_validator.py          # Скрипт проверки email-адресов
├── telegram_sender.py         # Скрипт отправки в Telegram
├── architecture_solution.md   # Архитектурное решение
├── requirements.txt           # Зависимости Python
├── README.md                  # Этот файл
├── examples/                  # Примеры использования
│   ├── sample_emails.txt      # Пример email-адресов
│   └── sample_message.txt     # Пример сообщения
└── .env.example              # Пример переменных окружения
```

## 1. Проверка email-доменов

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Запуск

#### Проверка отдельных email-адресов:
```bash
python email_validator.py user@example.com admin@test.org invalid@nonexistent.domain
```

#### Проверка email-адресов из файла:
```bash
python email_validator.py --file examples/sample_emails.txt
```

### Функциональность
- Проверка формата email-адреса
- Проверка существования домена
- Проверка MX-записей
- SMTP-валидация существования пользователя
- Параллельная обработка для ускорения

### Результаты
Скрипт выводит статус для каждого email:
- `домен валиден` - домен существует и имеет MX-записи
- `домен отсутствует` - домен не существует
- `MX-записи отсутствуют или некорректны` - нет почтовых серверов
- `пользователь существует` - SMTP-проверка прошла успешно
- `невалидный формат` - некорректный формат email

## 2. Интеграция с Telegram

### Настройка бота

1. **Создание бота:**
   - Найдите @BotFather в Telegram
   - Отправьте `/newbot`
   - Следуйте инструкциям
   - Сохраните токен бота

2. **Получение chat_id:**
   - Найдите @userinfobot
   - Отправьте ему любое сообщение
   - Скопируйте ваш chat_id

3. **Настройка переменных окружения:**
```bash
# Способ 1: Экспорт
export TELEGRAM_BOT_TOKEN="ваш_токен_бота"
export TELEGRAM_CHAT_ID="ваш_chat_id"

# Способ 2: Файл .env
cp .env.example .env
# Отредактируйте .env с вашими данными
```

### Запуск

#### Отправка текстового файла:
```bash
python telegram_sender.py examples/sample_message.txt
```

#### Получение помощи:
```bash
python telegram_sender.py --help
```

### Функциональность
- Автоматическое разделение длинных сообщений
- Поддержка кириллицы и различных кодировок
- Обработка ошибок сети
- Markdown форматирование сообщений

## 3. Архитектурное решение

Подробное описание архитектуры для обработки 1200 email-адресов находится в файле `architecture_solution.md`.

Ключевые особенности:
- Serverless архитектура на AWS
- Минимальная стоимость: ~$270/месяц
- Высокая отказоустойчивость
- Автоматическая ротация IP и доменов
- Мультипровайдерная стратегия

## Тестирование

### Создание тестовых файлов:
```bash
mkdir -p examples
echo "test@example.com
admin@gmail.com
invalid@nonexistent.domain
user@yandex.ru" > examples/sample_emails.txt

echo "Тестовое сообщение для отправки в Telegram.

Это многострочное сообщение
с переносами строк и специальными символами:
@ # $ % ^ & * ()

Успешной отправки!" > examples/sample_message.txt
```

### Запуск тестов:
```bash
# Тест валидатора email
python email_validator.py --file examples/sample_emails.txt

# Тест отправки в Telegram (требует настройки)
python telegram_sender.py examples/sample_message.txt
```

## Требования

- Python 3.7+
- Доступ в интернет для DNS и SMTP запросов
- Telegram бот для второго задания

## Зависимости

```
dnspython==2.6.2      # DNS запросы для MX-записей
requests==2.31.0      # HTTP запросы для Telegram API
python-dotenv==1.0.0  # Управление переменными окружения
```

## Примечания

- Email-валидатор использует параллельную обработку для ускорения
- Telegram-бот автоматически разделяет длинные сообщения (>4096 символов)
- Все скрипты поддерживают кодировку UTF-8 и кириллицу
- Скрипты обрабатывают ошибки сети и предоставляют информативные сообщения